<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iframe Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        .iframe-container {
            border: 2px solid blue;
            margin: 20px 0;
        }

        iframe {
            width: 100%;
            height: 400px;
            border: none;
        }

        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .success {
            background: #d4edda;
            color: #155724;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
        }

        .info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .log-container {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>

<body>
    <h1>Iframe Test Page</h1>
    <p>Testing iframe embedding for: <strong>https://staging.blawby.com/pay/DtOam9PORuNijS0Oklq6LVZDUQlY1t4E</strong>
    </p>

    <div class="iframe-container">
        <iframe src="https://staging.blawby.com/pay/DtOam9PORuNijS0Oklq6LVZDUQlY1t4E" title="Payment Form Test"
            sandbox="allow-scripts allow-same-origin allow-forms allow-popups" onload="handleLoad()"
            onerror="handleError()">
        </iframe>
    </div>

    <div id="status" class="status">Loading...</div>
    <button onclick="window.open('https://staging.blawby.com/pay/DtOam9PORuNijS0Oklq6LVZDUQlY1t4E', '_blank')">Open in
        New Tab</button>
    <button onclick="testHeaders()">Test Headers</button>
    <button onclick="clearLogs()">Clear Logs</button>

    <div id="log-container" class="log-container">
        <strong>Console Logs:</strong><br>
        <div id="logs"></div>
    </div>

    <script>
        const PAYMENT_URL = 'https://staging.blawby.com/pay/DtOam9PORuNijS0Oklq6LVZDUQlY1t4E';

        function log(message, type = 'info') {
            const timestamp = new Date().toISOString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            console.log(logEntry);

            const logsDiv = document.getElementById('logs');
            const logElement = document.createElement('div');
            logElement.style.color = type === 'error' ? '#dc3545' : type === 'success' ? '#28a745' : '#6c757d';
            logElement.textContent = logEntry;
            logsDiv.appendChild(logElement);
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }

        function handleLoad() {
            log('‚úÖ Iframe loaded successfully', 'success');
            document.getElementById('status').innerHTML = '‚úÖ Iframe loaded successfully';
            document.getElementById('status').className = 'status success';

            // Try to access iframe content
            try {
                const iframe = document.querySelector('iframe');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                log('‚úÖ Iframe content is accessible', 'success');
            } catch (e) {
                log(`‚ùå Iframe content is blocked: ${e.message}`, 'error');
            }
        }

        function handleError() {
            log('‚ùå Iframe failed to load', 'error');
            document.getElementById('status').innerHTML = '‚ùå Iframe failed to load';
            document.getElementById('status').className = 'status error';
        }

        async function testHeaders() {
            log('üîç Testing headers for payment URL...', 'info');

            try {
                const response = await fetch(PAYMENT_URL, {
                    method: 'HEAD',
                    mode: 'cors'
                });

                log(`üìä Response Status: ${response.status} ${response.statusText}`, 'info');

                // Log all headers
                const headers = {};
                response.headers.forEach((value, key) => {
                    headers[key] = value;
                    log(`üìã Header: ${key} = ${value}`, 'info');
                });

                // Check for specific security headers
                const securityHeaders = [
                    'content-security-policy',
                    'x-frame-options',
                    'frame-ancestors',
                    'x-content-type-options',
                    'x-xss-protection'
                ];

                log('üîí Security Headers Check:', 'info');
                securityHeaders.forEach(header => {
                    const value = response.headers.get(header);
                    if (value) {
                        log(`‚úÖ ${header}: ${value}`, 'success');
                    } else {
                        log(`‚ùå ${header}: Not set`, 'error');
                    }
                });

            } catch (error) {
                log(`‚ùå Fetch error: ${error.message}`, 'error');
            }
        }

        // Log initial page load info
        log('üöÄ Page loaded', 'info');
        log(`üìç Current URL: ${window.location.href}`, 'info');
        log(`üåê Current Origin: ${window.location.origin}`, 'info');
        log(`üì± User Agent: ${navigator.userAgent}`, 'info');
        log(`üîó Referrer: ${document.referrer || 'None'}`, 'info');

        // Check for security policy violations
        window.addEventListener('securitypolicyviolation', function (event) {
            log(`üö® Security Policy Violation: ${event.violatedDirective}`, 'error');
            log(`üö® Blocked URI: ${event.blockedURI}`, 'error');
            log(`üö® Document URI: ${event.documentURI}`, 'error');
            log(`üö® Source File: ${event.sourceFile}`, 'error');
            log(`üö® Line Number: ${event.lineNumber}`, 'error');
        });

        // Monitor iframe loading and errors
        window.addEventListener('message', function (event) {
            log(`üì® Received message from iframe: ${JSON.stringify(event.data)}`, 'info');
        });

        // Check if iframes are blocked after a delay
        setTimeout(function () {
            log('üîç Checking iframe accessibility...', 'info');
            const iframes = document.querySelectorAll('iframe');
            iframes.forEach((iframe, index) => {
                try {
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    log(`‚úÖ Iframe ${index + 1} is accessible`, 'success');
                } catch (e) {
                    log(`‚ùå Iframe ${index + 1} is blocked by security policy: ${e.message}`, 'error');
                }
            });
        }, 3000);

        // Log CSP violations
        window.addEventListener('error', function (event) {
            if (event.message.includes('frame') || event.message.includes('CSP')) {
                log(`üö® Error: ${event.message}`, 'error');
            }
        });

        // Test headers on page load
        setTimeout(testHeaders, 1000);
    </script>
</body>

</html>