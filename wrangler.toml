name = "blawby-ai-chatbot"
main = "worker/index.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

# Pages build output directory for frontend deployments
pages_build_output_dir = "dist"

# Fresh resources for AI chatbot
[[kv_namespaces]]
binding = "CHAT_SESSIONS"
id = "9ca96bd55b2d4455bad3fe0cda914f14"  # BLAWBY_AI_CHAT_SESSIONS
preview_id = "e7bbadb101d44a828fb3ef34528b3540"  # BLAWBY_AI_CHAT_SESSIONS_preview

[[d1_databases]]
binding = "DB"
database_name = "blawby-ai-chatbot"
database_id = "e4ed51fa-4787-4222-afed-bcddfefd13bf"  # blawby-ai-chatbot
migrations_dir = "worker/migrations"

# Secrets Configuration
# The following secrets should be set via wrangler secret put or .dev.vars:
# - RESEND_API_KEY: Email notifications
# - LAWYER_SEARCH_API_KEY: External lawyer search API
# - CLOUDFLARE_API_TOKEN: Cloudflare API access
# - CLOUDFLARE_ACCOUNT_ID: Cloudflare account identifier
# - ADOBE_CLIENT_ID: Adobe PDF Services
# - ADOBE_CLIENT_SECRET: Adobe PDF Services
# - ADOBE_TECHNICAL_ACCOUNT_ID: Adobe PDF Services
# - ADOBE_TECHNICAL_ACCOUNT_EMAIL: Adobe PDF Services
# - ADOBE_ORGANIZATION_ID: Adobe PDF Services

# R2 bucket for file storage
[[r2_buckets]]
binding = "FILES_BUCKET"
bucket_name = "blawby-ai-files"

# Queue producers removed - no queues are used

# Development environment
[env.dev]
name = "blawby-ai-chatbot-dev"
kv_namespaces = [
  { binding = "CHAT_SESSIONS", id = "e7bbadb101d44a828fb3ef34528b3540" }
]
d1_databases = [
  { binding = "DB", database_name = "blawby-ai-chatbot", database_id = "e4ed51fa-4787-4222-afed-bcddfefd13bf", migrations_dir = "worker/migrations" }
]
[[env.dev.r2_buckets]]
binding = "FILES_BUCKET"
bucket_name = "blawby-ai-files"

# Development environment variables
[env.dev.vars]
# Environment Configuration
NODE_ENV = "development"
LOG_LEVEL = "debug"
DEBUG = false
VITE_DEBUG_OVERLAY = false

# Remote API Configuration
REMOTE_API_URL = "https://staging-api.blawby.com"

# Lawyer Search API Configuration
LAWYER_SEARCH_API_URL = "https://search.blawby.com"
# LAWYER_SEARCH_API_KEY set via .dev.vars or wrangler secret

# Feature Flags
REQUIRE_EMAIL_VERIFICATION = "false"

# Adobe PDF Services Configuration
ENABLE_ADOBE_EXTRACT = true
ADOBE_IMS_BASE_URL = "https://ims-na1.adobelogin.com"
ADOBE_PDF_SERVICES_BASE_URL = "https://pdf-services.adobe.io"
ADOBE_SCOPE = "openid,AdobeID,DCAPI"
# Adobe secrets set via .dev.vars or wrangler secret

# Analysis Configuration
ANALYSIS_TIMEOUT_MS = "60000"

# Rate Limiting Configuration
RATE_LIMIT_REQUESTS_PER_MINUTE = "60"
RATE_LIMIT_BURST_SIZE = "10"
[env.production]
name = "blawby-ai-chatbot"
kv_namespaces = [
  { binding = "CHAT_SESSIONS", id = "9ca96bd55b2d4455bad3fe0cda914f14", preview_id = "e7bbadb101d44a828fb3ef34528b3540" }
]
d1_databases = [
  { binding = "DB", database_name = "blawby-ai-chatbot", database_id = "e4ed51fa-4787-4222-afed-bcddfefd13bf", migrations_dir = "worker/migrations" }
]

# Production environment variables
[env.production.vars]
# Environment Configuration
NODE_ENV = "production"
LOG_LEVEL = "warn"
DEBUG = false
VITE_DEBUG_OVERLAY = false

# Remote API Configuration
REMOTE_API_URL = "https://production-api.blawby.com"

# Lawyer Search API Configuration
LAWYER_SEARCH_API_URL = "https://search.blawby.com"
# LAWYER_SEARCH_API_KEY set via wrangler secret

# Feature Flags
REQUIRE_EMAIL_VERIFICATION = "false"

# Adobe PDF Services Configuration
ENABLE_ADOBE_EXTRACT = true
ADOBE_IMS_BASE_URL = "https://ims-na1.adobelogin.com"
ADOBE_PDF_SERVICES_BASE_URL = "https://pdf-services.adobe.io"
ADOBE_SCOPE = "openid,AdobeID,DCAPI"
# Adobe secrets set via wrangler secret

# Analysis Configuration
ANALYSIS_TIMEOUT_MS = "60000"

# Rate Limiting Configuration
RATE_LIMIT_REQUESTS_PER_MINUTE = "60"
RATE_LIMIT_BURST_SIZE = "10"
[[env.production.r2_buckets]]
binding = "FILES_BUCKET"
bucket_name = "blawby-ai-files"

[[env.production.routes]]
pattern = "ai.blawby.com/api/*"
zone_name = "blawby.com"

[observability]
[observability.logs]
enabled = false
head_sampling_rate = 1
invocation_logs = true