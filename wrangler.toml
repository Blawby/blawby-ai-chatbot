name = "blawby-ai-chatbot"
main = "worker/index.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

[ai]
binding = "AI"

[[ai.models]]
binding = "llama"
model = "@cf/meta/llama-3.1-8b-instruct"

[[ai.models]]
binding = "llava"
model = "@cf/llava-hf/llava-1.5-7b-hf"

# Fresh resources for AI chatbot
[[kv_namespaces]]
binding = "CHAT_SESSIONS"
id = "9ca96bd55b2d4455bad3fe0cda914f14"  # BLAWBY_AI_CHAT_SESSIONS
preview_id = "e7bbadb101d44a828fb3ef34528b3540"  # BLAWBY_AI_CHAT_SESSIONS_preview
experimental_remote = true

[[d1_databases]]
binding = "DB"
database_name = "blawby-ai-chatbot"
database_id = "e4ed51fa-4787-4222-afed-bcddfefd13bf"  # blawby-ai-chatbot
experimental_remote = true

# Resend API key for email notifications (set via wrangler secret put RESEND_API_KEY)

# Blawby API Configuration
[vars]
BLAWBY_API_URL = "https://staging.blawby.com"
BLAWBY_TEAM_ULID = "01jq70jnstyfzevc6423czh50e"
# BLAWBY_API_TOKEN should be set via: wrangler secret put BLAWBY_API_TOKEN

# Cloudflare AI Configuration
CLOUDFLARE_ACCOUNT_ID = "fa3dc6c06433f6b0ea78d95bce23ad91"
CLOUDFLARE_PUBLIC_URL = "https://blawby-ai-chatbot.paulchrisluke.workers.dev"
# CLOUDFLARE_API_TOKEN should be set via: wrangler secret put CLOUDFLARE_API_TOKEN

# R2 bucket for file storage
[[r2_buckets]]
binding = "FILES_BUCKET"
bucket_name = "blawby-ai-files"

# Queue producers for background processing
[[queues.producers]]
queue = "doc-events"
binding = "DOC_EVENTS"

# Queue consumers (disabled for now - consumers not implemented)
# [[queues.consumers]]
# queue = "doc-events"

# Durable Objects migrations removed - no longer using Durable Objects

# Domain configuration for ai.blawby.com
[env.production]
name = "blawby-ai-chatbot"
ai = { binding = "AI" }
kv_namespaces = [
  { binding = "CHAT_SESSIONS", id = "9ca96bd55b2d4455bad3fe0cda914f14", preview_id = "e7bbadb101d44a828fb3ef34528b3540", experimental_remote = true }
]
d1_databases = [
  { binding = "DB", database_name = "blawby-ai-chatbot", database_id = "e4ed51fa-4787-4222-afed-bcddfefd13bf", experimental_remote = true }
]
# Updated to use modern nested producers syntax
[[env.production.queues.producers]]
queue = "doc-events"
binding = "DOC_EVENTS"
# r2_buckets = [
#   { binding = "FILES_BUCKET", bucket_name = "blawby-ai-files" }
# ] 