name = "blawby-ai-chatbot"
account_id = "fa3dc6c06433f6b0ea78d95bce23ad91"
main = "index.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

[[kv_namespaces]]
binding = "CHAT_SESSIONS"
id = "9ca96bd55b2d4455bad3fe0cda914f14"  # BLAWBY_AI_CHAT_SESSIONS
preview_id = "e7bbadb101d44a828fb3ef34528b3540"  # BLAWBY_AI_CHAT_SESSIONS_preview

[[d1_databases]]
binding = "DB"
database_name = "blawby-ai-chatbot"
database_id = "e4ed51fa-4787-4222-afed-bcddfefd13bf"  # blawby-ai-chatbot
migrations_dir = "migrations"

[[r2_buckets]]
binding = "FILES_BUCKET"
bucket_name = "blawby-ai-files"

[[queues.producers]]
queue = "notification-events"
binding = "NOTIFICATION_EVENTS"

[[queues.consumers]]
queue = "notification-events"
max_batch_size = 10
max_batch_timeout = 30
max_retries = 3
dead_letter_queue = "notification-events-dlq"

[[durable_objects.bindings]]
name = "CHAT_ROOM"
class_name = "ChatRoom"

[[migrations]]
tag = "v2"
new_classes = ["ChatRoom"]

[[migrations]]
tag = "v3"
deleted_classes = ["NotificationHub"]

[[durable_objects.bindings]]
name = "MATTER_PROGRESS"
class_name = "MatterProgressRoom"

[[migrations]]
tag = "v4"
new_classes = ["MatterProgressRoom"]


[env.dev]
name = "blawby-ai-chatbot-dev"
kv_namespaces = [
  { binding = "CHAT_SESSIONS", id = "e7bbadb101d44a828fb3ef34528b3540" }
]
d1_databases = [
  { binding = "DB", database_name = "blawby-ai-chatbot", database_id = "e4ed51fa-4787-4222-afed-bcddfefd13bf", migrations_dir = "migrations" }
]
[[env.dev.r2_buckets]]
binding = "FILES_BUCKET"
bucket_name = "blawby-ai-files"

[[env.dev.queues.producers]]
queue = "notification-events-dev"
binding = "NOTIFICATION_EVENTS"

[[env.dev.queues.consumers]]
queue = "notification-events-dev"
max_batch_size = 10
max_batch_timeout = 30
max_retries = 3
dead_letter_queue = "notification-events-dev-dlq"

[[env.dev.durable_objects.bindings]]
name = "CHAT_ROOM"
class_name = "ChatRoom"

[[env.dev.durable_objects.bindings]]
name = "MATTER_PROGRESS"
class_name = "MatterProgressRoom"

[[env.dev.migrations]]
tag = "v2"
new_classes = ["ChatRoom"]

[[env.dev.migrations]]
tag = "v4"
new_classes = ["MatterProgressRoom"]

[env.dev.vars]
NODE_ENV = "development"
LOG_LEVEL = "debug"
DEBUG = false
VITE_DEBUG_OVERLAY = false
CLOUDFLARE_PUBLIC_URL = "https://local.blawby.com"
CLOUDFLARE_ACCOUNT_ID = "fa3dc6c06433f6b0ea78d95bce23ad91"
CF_AIG_GATEWAY_NAME = "blawby-ai"
AI_PROVIDER = "cloudflare_gateway"
BACKEND_API_URL = "https://staging-api.blawby.com"
ALLOWED_WS_ORIGINS = "https://local.blawby.com,http://local.blawby.com,http://localhost:5173,https://localhost:5173,http://localhost:5137,https://localhost:5137"
REQUIRE_EMAIL_VERIFICATION = false
ENABLE_EMAIL_NOTIFICATIONS = true
ENABLE_PUSH_NOTIFICATIONS = true
ENABLE_ADOBE_EXTRACT = true
ADOBE_IMS_BASE_URL = "https://ims-na1.adobelogin.com"
ADOBE_PDF_SERVICES_BASE_URL = "https://pdf-services.adobe.io"
ADOBE_SCOPE = "openid,AdobeID,DCAPI"
ANALYSIS_TIMEOUT_MS = "60000"
RATE_LIMIT_REQUESTS_PER_MINUTE = "60"
RATE_LIMIT_BURST_SIZE = "10"

[env.staging]
name = "blawby-ai-chatbot-staging"
kv_namespaces = [
  { binding = "CHAT_SESSIONS", id = "3f2317034f7b4ec7b51133b45a17caa9" }
]
d1_databases = [
  { binding = "DB", database_name = "blawby-ai-chatbot-staging", database_id = "73de3210-05e6-4147-9724-208b3df52963", migrations_dir = "migrations" }
]
[[env.staging.r2_buckets]]
binding = "FILES_BUCKET"
bucket_name = "blawby-ai-files-staging"

[[env.staging.queues.producers]]
queue = "notification-events-staging"
binding = "NOTIFICATION_EVENTS"

[[env.staging.queues.consumers]]
queue = "notification-events-staging"
max_batch_size = 10
max_batch_timeout = 30
max_retries = 3
dead_letter_queue = "notification-events-staging-dlq"

[[env.staging.durable_objects.bindings]]
name = "CHAT_ROOM"
class_name = "ChatRoom"

[[env.staging.durable_objects.bindings]]
name = "MATTER_PROGRESS"
class_name = "MatterProgressRoom"

[[env.staging.migrations]]
tag = "v6"
new_classes = ["MatterDiffStore"]

[[env.staging.migrations]]
tag = "v7"
deleted_classes = ["MatterDiffStore"]

[env.staging.vars]
NODE_ENV = "staging"
LOG_LEVEL = "warn"
DEBUG = false
VITE_DEBUG_OVERLAY = false
CLOUDFLARE_PUBLIC_URL = "https://ai-staging.blawby.com"
VITE_WORKER_API_URL = "https://ai-staging.blawby.com"
BACKEND_API_URL = "https://staging-api.blawby.com"
CLOUDFLARE_ACCOUNT_ID = "fa3dc6c06433f6b0ea78d95bce23ad91"
CF_AIG_GATEWAY_NAME = "blawby-ai"
AI_PROVIDER = "cloudflare_gateway"
ALLOWED_WS_ORIGINS = "https://ai-staging.blawby.com"
REQUIRE_EMAIL_VERIFICATION = false
ENABLE_EMAIL_NOTIFICATIONS = true
ENABLE_PUSH_NOTIFICATIONS = true
ENABLE_ADOBE_EXTRACT = true
ADOBE_IMS_BASE_URL = "https://ims-na1.adobelogin.com"
ADOBE_PDF_SERVICES_BASE_URL = "https://pdf-services.adobe.io"
ADOBE_SCOPE = "openid,AdobeID,DCAPI"
ANALYSIS_TIMEOUT_MS = "60000"
RATE_LIMIT_REQUESTS_PER_MINUTE = "60"
RATE_LIMIT_BURST_SIZE = "10"

[[env.staging.routes]]
pattern = "ai-staging.blawby.com/api/*"
zone_name = "blawby.com"

[env.production]
name = "blawby-ai-chatbot"
kv_namespaces = [
  { binding = "CHAT_SESSIONS", id = "9ca96bd55b2d4455bad3fe0cda914f14", preview_id = "e7bbadb101d44a828fb3ef34528b3540" }
]
d1_databases = [
  { binding = "DB", database_name = "blawby-ai-chatbot", database_id = "e4ed51fa-4787-4222-afed-bcddfefd13bf", migrations_dir = "migrations" }
]
[[env.production.migrations]]
tag = "v3"
deleted_classes = ["NotificationHub"]
[[env.production.migrations]]
tag = "v5"
new_classes = ["MatterProgressRoom"]
[[env.production.r2_buckets]]
binding = "FILES_BUCKET"
bucket_name = "blawby-ai-files"

[[env.production.queues.producers]]
queue = "notification-events"
binding = "NOTIFICATION_EVENTS"

[[env.production.queues.consumers]]
queue = "notification-events"
max_batch_size = 10
max_batch_timeout = 30
max_retries = 3
dead_letter_queue = "notification-events-dlq"

[[env.production.durable_objects.bindings]]
name = "CHAT_ROOM"
class_name = "ChatRoom"

[[env.production.durable_objects.bindings]]
name = "MATTER_PROGRESS"
class_name = "MatterProgressRoom"

[env.production.vars]
NODE_ENV = "production"
LOG_LEVEL = "warn"
DEBUG = false
VITE_DEBUG_OVERLAY = false
CLOUDFLARE_PUBLIC_URL = "https://ai.blawby.com"
BACKEND_API_URL = "https://production-api.blawby.com"
CLOUDFLARE_ACCOUNT_ID = "fa3dc6c06433f6b0ea78d95bce23ad91"
CF_AIG_GATEWAY_NAME = "blawby-ai"
AI_PROVIDER = "cloudflare_gateway"
ALLOWED_WS_ORIGINS = "https://ai.blawby.com,https://blawby.com,https://www.blawby.com"
REQUIRE_EMAIL_VERIFICATION = false
ENABLE_EMAIL_NOTIFICATIONS = true
ENABLE_PUSH_NOTIFICATIONS = true
ENABLE_ADOBE_EXTRACT = true
ADOBE_IMS_BASE_URL = "https://ims-na1.adobelogin.com"
ADOBE_PDF_SERVICES_BASE_URL = "https://pdf-services.adobe.io"
ADOBE_SCOPE = "openid,AdobeID,DCAPI"
ANALYSIS_TIMEOUT_MS = "60000"
RATE_LIMIT_REQUESTS_PER_MINUTE = "60"
RATE_LIMIT_BURST_SIZE = "10"

[[env.production.routes]]
pattern = "ai.blawby.com/api/*"
zone_name = "blawby.com"

[observability]
[observability.logs]
enabled = false
head_sampling_rate = 1
invocation_logs = true
