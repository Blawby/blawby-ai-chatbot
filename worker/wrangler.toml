name = "blawby-ai-chatbot"
main = "index.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

[[kv_namespaces]]
binding = "CHAT_SESSIONS"
id = "9ca96bd55b2d4455bad3fe0cda914f14"  # BLAWBY_AI_CHAT_SESSIONS
preview_id = "e7bbadb101d44a828fb3ef34528b3540"  # BLAWBY_AI_CHAT_SESSIONS_preview

[[d1_databases]]
binding = "DB"
database_name = "blawby-ai-chatbot"
database_id = "e4ed51fa-4787-4222-afed-bcddfefd13bf"  # blawby-ai-chatbot
migrations_dir = "migrations"

[[r2_buckets]]
binding = "FILES_BUCKET"
bucket_name = "blawby-ai-files"

[[queues.producers]]
queue = "notification-events"
binding = "NOTIFICATION_EVENTS"

[[queues.consumers]]
queue = "notification-events"
max_batch_size = 10
max_batch_timeout = 30
max_retries = 3
dead_letter_queue = "notification-events-dlq"

[[durable_objects.bindings]]
name = "NOTIFICATION_HUB"
class_name = "NotificationHub"

[[migrations]]
tag = "v1"
new_classes = ["NotificationHub"]

[env.dev]
name = "blawby-ai-chatbot-dev"
kv_namespaces = [
  { binding = "CHAT_SESSIONS", id = "e7bbadb101d44a828fb3ef34528b3540" }
]
d1_databases = [
  { binding = "DB", database_name = "blawby-ai-chatbot", database_id = "e4ed51fa-4787-4222-afed-bcddfefd13bf", migrations_dir = "migrations" }
]
[[env.dev.r2_buckets]]
binding = "FILES_BUCKET"
bucket_name = "blawby-ai-files"

[[env.dev.queues.producers]]
queue = "notification-events"
binding = "NOTIFICATION_EVENTS"

[[env.dev.queues.consumers]]
queue = "notification-events"
max_batch_size = 10
max_batch_timeout = 30
max_retries = 3
dead_letter_queue = "notification-events-dlq"

[[env.dev.durable_objects.bindings]]
name = "NOTIFICATION_HUB"
class_name = "NotificationHub"

[env.dev.vars]
NODE_ENV = "development"
LOG_LEVEL = "debug"
DEBUG = false
VITE_DEBUG_OVERLAY = false
CLOUDFLARE_PUBLIC_URL = "https://local.blawby.com"
# REMOTE_API_URL is set in worker/.dev.vars for local development
# Default to staging if not set in .dev.vars
# REMOTE_API_URL = "https://staging-api.blawby.com"
LAWYER_SEARCH_API_URL = "https://search.blawby.com"
REQUIRE_EMAIL_VERIFICATION = "false"
ENABLE_ADOBE_EXTRACT = true
ADOBE_IMS_BASE_URL = "https://ims-na1.adobelogin.com"
ADOBE_PDF_SERVICES_BASE_URL = "https://pdf-services.adobe.io"
ADOBE_SCOPE = "openid,AdobeID,DCAPI"
ANALYSIS_TIMEOUT_MS = "60000"
RATE_LIMIT_REQUESTS_PER_MINUTE = "60"
RATE_LIMIT_BURST_SIZE = "10"

[env.production]
name = "blawby-ai-chatbot"
kv_namespaces = [
  { binding = "CHAT_SESSIONS", id = "9ca96bd55b2d4455bad3fe0cda914f14", preview_id = "e7bbadb101d44a828fb3ef34528b3540" }
]
d1_databases = [
  { binding = "DB", database_name = "blawby-ai-chatbot", database_id = "e4ed51fa-4787-4222-afed-bcddfefd13bf", migrations_dir = "migrations" }
]
[[env.production.r2_buckets]]
binding = "FILES_BUCKET"
bucket_name = "blawby-ai-files"

[[env.production.queues.producers]]
queue = "notification-events"
binding = "NOTIFICATION_EVENTS"

[[env.production.queues.consumers]]
queue = "notification-events"
max_batch_size = 10
max_batch_timeout = 30
max_retries = 3
dead_letter_queue = "notification-events-dlq"

[[env.production.durable_objects.bindings]]
name = "NOTIFICATION_HUB"
class_name = "NotificationHub"

[env.production.vars]
NODE_ENV = "production"
LOG_LEVEL = "warn"
DEBUG = false
VITE_DEBUG_OVERLAY = false
CLOUDFLARE_PUBLIC_URL = "https://ai.blawby.com"
REMOTE_API_URL = "https://production-api.blawby.com"
LAWYER_SEARCH_API_URL = "https://search.blawby.com"
REQUIRE_EMAIL_VERIFICATION = "false"
ENABLE_ADOBE_EXTRACT = true
ADOBE_IMS_BASE_URL = "https://ims-na1.adobelogin.com"
ADOBE_PDF_SERVICES_BASE_URL = "https://pdf-services.adobe.io"
ADOBE_SCOPE = "openid,AdobeID,DCAPI"
ANALYSIS_TIMEOUT_MS = "60000"
RATE_LIMIT_REQUESTS_PER_MINUTE = "60"
RATE_LIMIT_BURST_SIZE = "10"

[[env.production.routes]]
pattern = "ai.blawby.com/api/*"
zone_name = "blawby.com"

[observability]
[observability.logs]
enabled = false
head_sampling_rate = 1
invocation_logs = true
